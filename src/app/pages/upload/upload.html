<div class="upload-container">
  <h2>File Upload</h2>

  <!-- Drop Zone -->
  <div
    class="drop-zone"
    [class.dragging]="isDragging()"
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave($event)"
    (drop)="onDrop($event)"
  >
    <div class="drop-zone-content">
      <span class="upload-icon">üì§</span>
      <p>K√©o th·∫£ file v√†o ƒë√¢y ho·∫∑c</p>
      <label for="fileInput" class="btn btn-primary">
        Ch·ªçn file
        <input
          type="file"
          id="fileInput"
          multiple
          accept=".jpg,.jpeg,.png,.gif,.pdf"
          (change)="onFileSelected($event)"
          hidden
        />
      </label>
      <p class="hint">Ch·∫•p nh·∫≠n: JPG, PNG, GIF, PDF (T·ªëi ƒëa 5MB)</p>
    </div>
  </div>

  <!-- Overall Progress -->
  @if (hasFiles() && isUploading()) {
    <div class="overall-progress">
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="uploadProgress()"></div>
      </div>
      <span class="progress-text">{{ uploadProgress() }}%</span>
    </div>
  }

  <!-- Files List -->
  @if (hasFiles()) {
    <div class="files-list">
      <div class="files-header">
        <h3>Files ({{ selectedFiles().length }})</h3>
        <div class="files-actions">
          @if (canUpload()) {
            <button class="btn btn-success" (click)="uploadAllFiles()">Upload t·∫•t c·∫£</button>
          }
          <button class="btn btn-secondary" (click)="clearSuccessful()">X√≥a ƒë√£ upload</button>
          <button class="btn btn-danger" (click)="clearAll()">X√≥a t·∫•t c·∫£</button>
        </div>
      </div>

      <div class="file-items">
        @for (fileItem of selectedFiles(); track $index) {
          <div class="file-item" [class]="fileItem.status">
            <div class="file-info">
              <span class="file-icon">{{ getFileIcon(fileItem.file) }}</span>
              <div class="file-details">
                <div class="file-name">{{ fileItem.file.name }}</div>
                <div class="file-size">{{ formatFileSize(fileItem.file.size) }}</div>
                @if (fileItem.message) {
                  <div class="file-message" [class]="fileItem.status">
                    {{ fileItem.message }}
                  </div>
                }
              </div>
            </div>

            <div class="file-actions">
              @if (fileItem.status === 'pending') {
                <button class="btn btn-sm btn-primary" (click)="uploadFile($index)">Upload</button>
              }

              @if (fileItem.status === 'uploading') {
                <div class="progress-bar-small">
                  <div class="progress-fill" [style.width.%]="fileItem.progress"></div>
                </div>
                <span class="progress-text-small">{{ fileItem.progress }}%</span>
              }

              @if (fileItem.status === 'success') {
                <span class="status-icon success">‚úì</span>
                @if (fileItem.url) {
                  <a [href]="fileItem.url" target="_blank" class="btn btn-sm btn-link"> Xem </a>
                }
              }

              @if (fileItem.status === 'error') {
                <span class="status-icon error">‚úó</span>
                <button class="btn btn-sm btn-primary" (click)="uploadFile($index)">Th·ª≠ l·∫°i</button>
              }

              <button class="btn btn-sm btn-danger" (click)="removeFile($index)">X√≥a</button>
            </div>
          </div>
        }
      </div>
    </div>
  }
</div>
